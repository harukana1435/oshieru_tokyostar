# 取引管理機能詳細

## 概要

推しエール口座では、実際の銀行取引データに基づいて、インテリジェントな取引管理機能を提供しています。

## 🤖 自動振り分け機能

### 対象取引

以下の摘要は自動的にカテゴリ分類されます：

| 摘要 | カテゴリ | 口座種別 |
|------|----------|----------|
| 給与振込 | salary | life |
| 賞与振込 | salary | life |
| 電気料金 | utilities | life |
| 電話料金 | utilities | life |
| 生命保険料 | other | life |
| 預金利息 | other | life |
| キャッシュバック | other | life |
| ＩＢ振込手数料キャッシュバック | other | life |
| 振込手数料（ＩＢ） | other | life |
| ネット利用料 | utilities | life |
| コンビニＡＴＭ利用料 | other | life |

### 自動振り分けの利点

- ✅ 手動入力の手間を削減
- ✅ 一貫性のあるカテゴリ分類
- ✅ 即座にスコア計算に反映

## ⏸️ 保留グループ機能

### 対象取引

以下の摘要は保留グループに分類され、ユーザーによる手動振り分けが必要です：

- **クレジットカード**: 支払い内容が不明なため
- **インターネット振込**: 振込先・用途が多様なため
- **振込**: 一般的な振込（用途不明）
- **銀行間提携**: ATM利用等（用途確認必要）
- **その他振替**: 用途が特定できない振替

### 保留グループの重要性

1. **正確性の向上**: 推測による誤分類を防止
2. **ユーザー意図の反映**: 実際の用途に基づく分類
3. **スコア精度の向上**: 正確な分類により信頼性の高いスコア算出

## ✏️ 編集機能

### 編集可能な項目

- **用途カテゴリ**: 自動振り分け後も変更可能
- **メモ**: 追加の説明や詳細情報
- **口座種別**: 生活口座 ⇔ 推し活口座の振り分け

### 編集のメリット

- 🔄 後から気づいた分類ミスの修正
- 📝 詳細な記録の追加
- 🎯 より精密なスコア算出

## 💾 実データ仕様

### データソース

- **顧客数**: 3人
- **取引件数**: 178件（2024年6月〜7月）
- **データ形式**: 実際の銀行システムの摘要・取引コード

### データ構造

```json
{
  "id": "取引ID",
  "originalDescription": "銀行システムの元摘要",
  "amount": "取引金額",
  "isAutoCategorized": "自動振り分け済みフラグ",
  "isPending": "保留中フラグ",
  "canEdit": "編集可能フラグ",
  "originalCode": "取引履歴通帳摘要コード"
}
```

## 🎯 推し活安心度スコアへの影響

### 正確な分類の重要性

1. **収入認識**: 給与・賞与の正確な把握
2. **生活費算出**: 必要経費の適切な分類
3. **推し活費特定**: 推し活関連支出の明確化

### スコア向上のコツ

- ⭐ 保留中の取引を早めに分類
- ⭐ 推し活支出は推し活口座に振り分け
- ⭐ 定期的な取引履歴の見直し

## 🔧 技術実装

### 自動振り分けロジック

```typescript
const auto_categorization = {
  '給与振込': { purpose: 'salary', account_type: 'life' },
  '電気料金': { purpose: 'utilities', account_type: 'life' },
  // ... その他のルール
}

const pending_keywords = [
  'クレジットカード', 
  'インターネット振込', 
  '振込', 
  '銀行間提携', 
  'その他振替'
]
```

### データベーススキーマ

```sql
CREATE TABLE transactions (
  id TEXT PRIMARY KEY,
  original_description TEXT,
  is_auto_categorized BOOLEAN DEFAULT FALSE,
  is_pending BOOLEAN DEFAULT FALSE,
  can_edit BOOLEAN DEFAULT TRUE,
  original_code INTEGER,
  -- ... その他のフィールド
);
```

## 📊 ユーザーインターフェース

### 視覚的フィードバック

- 🟢 **緑色**: 自動振り分け済み取引
- 🟡 **黄色**: 保留中取引（要手動振り分け）
- ⚪ **グレー**: 通常の取引

### 操作フロー

1. 取引データの自動取込
2. 自動振り分けルールの適用
3. 保留グループの識別
4. ユーザーによる手動振り分け
5. 必要に応じて編集・修正
6. スコア計算への反映

---

この機能により、ユーザーは効率的かつ正確な家計管理を行い、より精密な推し活安心度スコアを得ることができます。 