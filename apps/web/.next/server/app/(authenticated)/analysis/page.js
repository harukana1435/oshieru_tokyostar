(()=>{var e={};e.id=546,e.ids=[546],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1373:(e,s,a)=>{"use strict";a.r(s),a.d(s,{GlobalError:()=>n.a,__next_app__:()=>m,originalPathname:()=>x,pages:()=>o,routeModule:()=>h,tree:()=>d});var t=a(8090),r=a(9409),l=a(1522),n=a.n(l),i=a(1305),c={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>i[e]);a.d(s,c);let d=["",{children:["(authenticated)",{children:["analysis",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,3907)),"/Users/h-okano/Dev/softbank_hackason/apps/web/app/(authenticated)/analysis/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,4110)),"/Users/h-okano/Dev/softbank_hackason/apps/web/app/(authenticated)/layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,111,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(a.bind(a,87)),"/Users/h-okano/Dev/softbank_hackason/apps/web/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,111,23)),"next/dist/client/components/not-found-error"]}],o=["/Users/h-okano/Dev/softbank_hackason/apps/web/app/(authenticated)/analysis/page.tsx"],x="/(authenticated)/analysis/page",m={require:a,loadChunk:()=>Promise.resolve()},h=new t.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/(authenticated)/analysis/page",pathname:"/analysis",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},8828:(e,s,a)=>{Promise.resolve().then(a.bind(a,8463))},8463:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>b});var t=a(4297),r=a(5803),l=a(3776),n=a(4209),i=a(1275),c=a(6545),d=a(7728),o=a(1918),x=a(8210),m=a(3766),h=a(360),u=a(7119),p=a(2858);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let g=(0,p.Z)("Brain",[["path",{d:"M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z",key:"1mhkh5"}],["path",{d:"M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z",key:"1d6s00"}]]),j=(0,p.Z)("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);var y=a(9743);function f(){let[e,s]=(0,r.useState)(!0),[a,p]=(0,r.useState)(null),[f,b]=(0,r.useState)(null),[N,v]=(0,r.useState)(!1),[k,w]=(0,r.useState)(null),S=(0,l.useRouter)();(0,r.useEffect)(()=>{Z()},[]);let Z=async()=>{try{s(!0);let e=localStorage.getItem("currentUser");if(!e){S.push("/login");return}let a=JSON.parse(e),t=localStorage.getItem("sessionId"),r=a.email||localStorage.getItem("userEmail")||"customer1@oshieru.com",l=await fetch("https://oshieru-api.harukana1435.workers.dev/dashboard",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`,"X-User-Email":r},body:JSON.stringify({userId:a.id})});if(l.ok){let e=await l.json();e.success&&p({score:{total:e.data.latestScore?.score||0,label:e.data.latestScore?.label||"評価中",factors:e.data.latestScore?.factors||{},breakdown:e.data.latestScore?.breakdown||{incomeRatioScore:0,surplusScore:0,recommendedAmountScore:0}},accounts:{totalBalance:e.data.totalBalance||0,life:e.data.accounts?.find(e=>"life"===e.kind),oshi:e.data.accounts?.find(e=>"oshi"===e.kind)},summary:{totalTransactions:e.data.recentTransactions?.length||0,oshiExpenses:e.data.recentTransactions?.filter(e=>"out"===e.sign&&"oshi"===e.accountKind).reduce((e,s)=>e+s.amount,0)||0,lifeExpenses:e.data.recentTransactions?.filter(e=>"out"===e.sign&&"life"===e.accountKind).reduce((e,s)=>e+s.amount,0)||0,income:e.data.recentTransactions?.filter(e=>"in"===e.sign&&"salary"===e.purpose).reduce((e,s)=>e+s.amount,0)||0}})}}catch(e){console.error("Failed to fetch analysis data:",e),w("データの取得に失敗しました")}finally{s(!1)}},_=async()=>{v(!0),w(null);try{let e=JSON.parse(localStorage.getItem("currentUser")||"{}"),s=localStorage.getItem("sessionId"),a=e.email||localStorage.getItem("userEmail")||"customer1@oshieru.com",t=await fetch("https://oshieru-api.harukana1435.workers.dev/analysis/rag-analysis",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`,"X-User-Email":a}});if(t.ok){let e=await t.json();e.success?b(e.analysis):w(e.error||"Analysis failed")}else w("分析の実行に失敗しました")}catch(e){console.error("RAG analysis error:",e),w("ネットワークエラーが発生しました")}finally{v(!1)}};return e?t.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:t.jsx(c.g,{})}):a?(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"スコア分析"}),t.jsx("p",{className:"text-gray-600",children:"推し活安心度スコアの詳細分析とAIによる個人分析"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,t.jsxs)(i.Zb,{className:"lg:col-span-1",children:[t.jsx(i.Ol,{children:(0,t.jsxs)(i.ll,{className:"flex items-center gap-2",children:[t.jsx(x.Z,{className:"w-5 h-5 text-green-600"}),"総合スコア"]})}),t.jsx(i.aY,{children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsxs)("div",{className:"text-4xl font-bold text-gray-900 mb-2",children:[a.score.total,t.jsx("span",{className:"text-lg text-gray-500",children:"/100"})]}),t.jsx("div",{className:"text-lg font-medium text-green-600 mb-4",children:a.score.label}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:t.jsx("div",{className:"bg-gradient-to-r from-green-500 to-blue-500 h-3 rounded-full transition-all duration-500",style:{width:`${a.score.total}%`}})})]})})]}),(0,t.jsxs)(i.Zb,{className:"lg:col-span-2",children:[t.jsx(i.Ol,{children:(0,t.jsxs)(i.ll,{className:"flex items-center gap-2",children:[t.jsx(m.Z,{className:"w-5 h-5 text-blue-600"}),"スコア内訳"]})}),t.jsx(i.aY,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[t.jsx("span",{className:"font-medium text-gray-700",children:"収入比率スコア"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-24 bg-gray-200 rounded-full h-2",children:t.jsx("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:`${a.score.breakdown.incomeRatioScore/40*100}%`}})}),(0,t.jsxs)("span",{className:"text-sm font-bold text-gray-900 w-16 text-right",children:[a.score.breakdown.incomeRatioScore,"/40"]})]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[t.jsx("span",{className:"font-medium text-gray-700",children:"余剰金スコア"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-24 bg-gray-200 rounded-full h-2",children:t.jsx("div",{className:"bg-green-500 h-2 rounded-full",style:{width:`${a.score.breakdown.surplusScore/30*100}%`}})}),(0,t.jsxs)("span",{className:"text-sm font-bold text-gray-900 w-16 text-right",children:[a.score.breakdown.surplusScore,"/30"]})]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[t.jsx("span",{className:"font-medium text-gray-700",children:"推奨額適合スコア"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-24 bg-gray-200 rounded-full h-2",children:t.jsx("div",{className:"bg-purple-500 h-2 rounded-full",style:{width:`${a.score.breakdown.recommendedAmountScore/30*100}%`}})}),(0,t.jsxs)("span",{className:"text-sm font-bold text-gray-900 w-16 text-right",children:[a.score.breakdown.recommendedAmountScore,"/30"]})]})]})]})})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,t.jsxs)(i.Zb,{children:[t.jsx(i.Ol,{children:(0,t.jsxs)(i.ll,{className:"flex items-center gap-2",children:[t.jsx(h.Z,{className:"w-5 h-5 text-blue-600"}),"収支サマリー（直近3ヶ月）"]})}),t.jsx(i.aY,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"収入"}),t.jsx("span",{className:"font-bold text-green-600",children:(0,d.xG)(a.summary.income)})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"推し活支出"}),t.jsx("span",{className:"font-bold text-purple-600",children:(0,d.xG)(a.summary.oshiExpenses)})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"生活支出"}),t.jsx("span",{className:"font-bold text-blue-600",children:(0,d.xG)(a.summary.lifeExpenses)})]}),t.jsx("div",{className:"border-t pt-2",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"font-medium text-gray-900",children:"推し活比率"}),t.jsx("span",{className:"font-bold text-gray-900",children:a.summary.income>0?`${Math.round(a.summary.oshiExpenses/a.summary.income*100)}%`:"---"})]})})]})})]}),(0,t.jsxs)(i.Zb,{children:[t.jsx(i.Ol,{children:(0,t.jsxs)(i.ll,{className:"flex items-center gap-2",children:[t.jsx(u.Z,{className:"w-5 h-5 text-green-600"}),"現在の残高"]})}),t.jsx(i.aY,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"総残高"}),t.jsx("span",{className:"font-bold text-gray-900",children:(0,d.xG)(a.accounts.totalBalance)})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"生活口座"}),t.jsx("span",{className:"font-bold text-green-600",children:(0,d.xG)(a.accounts.life?.balanceCached||0)})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"推し活口座"}),t.jsx("span",{className:"font-bold text-purple-600",children:(0,d.xG)(a.accounts.oshi?.balanceCached||0)})]}),t.jsx("div",{className:"border-t pt-2",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"font-medium text-gray-900",children:"取引回数"}),(0,t.jsxs)("span",{className:"font-bold text-gray-900",children:[a.summary.totalTransactions,"件"]})]})})]})})]})]}),(0,t.jsxs)(i.Zb,{children:[t.jsx(i.Ol,{children:(0,t.jsxs)(i.ll,{className:"flex items-center gap-2",children:[t.jsx(g,{className:"w-5 h-5 text-purple-600"}),"AI推し活分析"]})}),(0,t.jsxs)(i.aY,{children:[!f&&!N&&(0,t.jsxs)("div",{className:"text-center py-8",children:[t.jsx("div",{className:"w-16 h-16 bg-gradient-to-r from-purple-100 to-pink-100 rounded-full flex items-center justify-center mx-auto mb-4",children:t.jsx(j,{className:"w-8 h-8 text-purple-600"})}),t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"個人分析を開始"}),(0,t.jsxs)("p",{className:"text-gray-600 mb-6",children:["あなたの推し活パターンをAIが詳しく分析し、",t.jsx("br",{}),"個別のアドバイスを提供します。"]}),(0,t.jsxs)(n.z,{onClick:_,className:"bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white",children:[t.jsx(g,{className:"w-4 h-4 mr-2"}),"AI分析を開始"]})]}),N&&(0,t.jsxs)("div",{className:"text-center py-12",children:[t.jsx(y.Z,{className:"w-8 h-8 animate-spin text-purple-600 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"分析中..."}),t.jsx("p",{className:"text-gray-600",children:"AIがあなたの推し活データを詳しく分析しています"})]}),k&&(0,t.jsxs)("div",{className:"text-center py-8",children:[t.jsx(o.Z,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"エラーが発生しました"}),t.jsx("p",{className:"text-red-600 mb-4",children:k}),t.jsx(n.z,{onClick:_,variant:"outline",children:"再試行"})]}),f&&(0,t.jsxs)("div",{className:"space-y-4",children:[t.jsx("div",{className:"prose prose-sm max-w-none",children:t.jsx("div",{className:"whitespace-pre-wrap text-gray-700 leading-relaxed bg-gray-50 rounded-lg p-4",children:f})}),t.jsx("div",{className:"flex justify-center pt-4",children:t.jsx(n.z,{onClick:_,variant:"outline",size:"sm",children:"再分析"})})]})]})]})]}):(0,t.jsxs)("div",{className:"text-center py-12",children:[t.jsx(o.Z,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),t.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"データの読み込みに失敗しました"}),t.jsx("p",{className:"text-gray-600 mb-4",children:"しばらく時間をおいて再度お試しください"}),t.jsx(n.z,{onClick:Z,children:"再読み込み"})]})}function b(){return t.jsx(f,{})}},1918:(e,s,a)=>{"use strict";a.d(s,{Z:()=>t});/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let t=(0,a(2858).Z)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},360:(e,s,a)=>{"use strict";a.d(s,{Z:()=>t});/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let t=(0,a(2858).Z)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]])},9743:(e,s,a)=>{"use strict";a.d(s,{Z:()=>t});/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let t=(0,a(2858).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},8210:(e,s,a)=>{"use strict";a.d(s,{Z:()=>t});/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let t=(0,a(2858).Z)("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]])},3907:(e,s,a)=>{"use strict";a.r(s),a.d(s,{$$typeof:()=>l,__esModule:()=>r,default:()=>n});let t=(0,a(7460).createProxy)(String.raw`/Users/h-okano/Dev/softbank_hackason/apps/web/app/(authenticated)/analysis/page.tsx`),{__esModule:r,$$typeof:l}=t,n=t.default}};var s=require("../../../webpack-runtime.js");s.C(e);var a=e=>s(s.s=e),t=s.X(0,[79,94,296,703],()=>a(1373));module.exports=t})();