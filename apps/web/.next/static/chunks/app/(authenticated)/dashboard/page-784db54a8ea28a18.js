(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[598],{1890:function(e,s,t){Promise.resolve().then(t.bind(t,918))},918:function(e,s,t){"use strict";t.r(s),t.d(s,{DashboardContent:function(){return k}});var a=t(9075),l=t(511),n=t(5095),r=t(7839),c=t(9042),i=t(1438);function o(e){let{account:s,transactions:t,onClose:l}=e,n=t.filter(e=>{if(e.accountId&&s.id){let t=e.accountId===s.id;return t&&console.log("Transaction ".concat(e.id," matched by accountId: ").concat(e.accountId," === ").concat(s.id)),t}if(e.accountKind){let t=e.accountKind===s.kind;return t&&console.log("Transaction ".concat(e.id," matched by accountKind: ").concat(e.accountKind," === ").concat(s.kind)),t}let t="life"===s.kind&&"ticket"!==e.purpose&&"goods"!==e.purpose&&"event"!==e.purpose||"oshi"===s.kind&&("ticket"===e.purpose||"goods"===e.purpose||"event"===e.purpose);return t&&console.log("Transaction ".concat(e.id," matched by purpose fallback: purpose=").concat(e.purpose,", account.kind=").concat(s.kind)),t});console.log("AccountDetailsModal: Found ".concat(n.length," transactions for account ").concat(s.name," (").concat(s.kind,")")),console.log("Account ID:",s.id),console.log("All transactions count:",t.length);let o=n.filter(e=>"in"===e.sign).reduce((e,s)=>e+s.amount,0),d=n.filter(e=>"out"===e.sign).reduce((e,s)=>e+s.amount,0);return(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:(0,a.jsxs)(i.Zb,{className:"w-full max-w-4xl max-h-[90vh] flex flex-col bg-white shadow-2xl",children:[(0,a.jsx)(i.Ol,{className:"flex-shrink-0 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-purple-50",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)(i.ll,{className:"text-2xl font-bold text-gray-800 flex items-center gap-2",children:["life"===s.kind?"\uD83D\uDCB0":"✨"," ",s.name,"詳細"]}),(0,a.jsxs)(i.SZ,{className:"text-lg font-semibold text-blue-600 mt-1",children:["残高: ",(0,c.xG)(s.balanceCached)]})]}),(0,a.jsx)(r.z,{variant:"ghost",onClick:l,className:"hover:bg-white/80 rounded-full w-10 h-10 p-0",children:(0,a.jsx)("span",{className:"text-xl text-gray-500 hover:text-gray-700",children:"✕"})})]})}),(0,a.jsxs)(i.aY,{className:"flex-1 overflow-y-auto p-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-6 mb-8",children:[(0,a.jsxs)("div",{className:"p-6 bg-gradient-to-br from-green-50 to-emerald-100 rounded-xl border border-green-200 shadow-sm",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)("span",{className:"text-2xl",children:"\uD83D\uDCC8"}),(0,a.jsx)("p",{className:"text-sm font-medium text-green-700",children:"総収入"})]}),(0,a.jsx)("p",{className:"text-2xl font-bold text-green-800",children:(0,c.xG)(o)})]}),(0,a.jsxs)("div",{className:"p-6 bg-gradient-to-br from-red-50 to-rose-100 rounded-xl border border-red-200 shadow-sm",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)("span",{className:"text-2xl",children:"\uD83D\uDCC9"}),(0,a.jsx)("p",{className:"text-sm font-medium text-red-700",children:"総支出"})]}),(0,a.jsx)("p",{className:"text-2xl font-bold text-red-800",children:(0,c.xG)(d)})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,a.jsx)("span",{className:"text-xl",children:"\uD83D\uDCCB"}),(0,a.jsx)("h3",{className:"text-lg font-bold text-gray-800",children:"取引履歴"}),(0,a.jsxs)("span",{className:"text-sm text-gray-500 bg-gray-100 px-2 py-1 rounded-full",children:[n.length,"件"]})]}),(0,a.jsx)("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:0===n.length?(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("span",{className:"text-4xl mb-4 block",children:"\uD83D\uDCED"}),(0,a.jsx)("p",{className:"text-gray-500 font-medium",children:"取引履歴がありません"})]}):n.sort((e,s)=>new Date(s.eventAt).getTime()-new Date(e.eventAt).getTime()).map(e=>(0,a.jsx)("div",{className:"p-4 rounded-xl border transition-all hover:shadow-md ".concat(e.isPending?"bg-gradient-to-r from-yellow-50 to-amber-50 border-yellow-300 shadow-sm":e.isAutoCategorized?"bg-gradient-to-r from-green-50 to-emerald-50 border-green-300 shadow-sm":"bg-gradient-to-r from-gray-50 to-slate-50 border-gray-200"),children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("p",{className:"font-medium",children:e.memo}),e.isAutoCategorized&&(0,a.jsx)("span",{className:"text-xs px-2 py-1 bg-green-100 text-green-700 rounded-full",children:"自動分類"}),e.isPending&&(0,a.jsx)("span",{className:"text-xs px-2 py-1 bg-yellow-100 text-yellow-700 rounded-full",children:"保留中"})]}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:[(0,c.o0)(e.eventAt)," • ",e.purpose]})]}),(0,a.jsx)("div",{className:"text-right",children:(0,a.jsxs)("p",{className:"font-medium ".concat("out"===e.sign?"text-red-600":"text-green-600"),children:["out"===e.sign?"-":"+",(0,c.xG)(e.amount)]})})]})},e.id))})]})]})]})})}let d=[{value:"salary",label:"給与・収入"},{value:"ticket",label:"チケット"},{value:"goods",label:"グッズ"},{value:"event",label:"イベント"},{value:"food",label:"食費"},{value:"rent",label:"家賃・住居費"},{value:"utilities",label:"光熱費・通信費"},{value:"transport",label:"交通費"},{value:"other",label:"その他"}],x=[{value:"life",label:"生活口座"},{value:"oshi",label:"推し活口座"}];function m(e){var s;let{transaction:t,onSave:n,onClose:o}=e,[m,u]=(0,l.useState)({...t}),[h,g]=(0,l.useState)(["ticket","goods","event"].includes(t.purpose)?"oshi":"life");(0,l.useEffect)(()=>{u({...t}),t.accountKind?g(t.accountKind):g(["ticket","goods","event"].includes(t.purpose)?"oshi":"life")},[t]);let b=async()=>{let e=m.purpose;"oshi"!==h||["ticket","goods","event"].includes(e)||(e="other");try{let s=await fetch("".concat("https://oshieru-api.harukana1435.workers.dev","/transactions/").concat(t.id),{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("sessionId")),"X-User-Email":localStorage.getItem("userEmail")||""},body:JSON.stringify({purpose:e,memo:m.memo,accountType:h})});if(s.ok){let e=await s.json();console.log("Transaction updated via API:",e);let t={...e.transaction,eventAt:new Date(e.transaction.eventAt),createdAt:new Date(e.transaction.createdAt),isAutoCategorized:!1,isPending:!1};n(t),o()}else console.error("Failed to update transaction:",await s.text()),alert("取引の更新に失敗しました")}catch(e){console.error("Error updating transaction:",e),alert("取引の更新中にエラーが発生しました")}};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:(0,a.jsxs)(i.Zb,{className:"w-full max-w-md",children:[(0,a.jsx)(i.Ol,{children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(i.ll,{children:"取引を編集"}),(0,a.jsxs)(i.SZ,{children:[(0,c.xG)(t.amount)," • ",t.eventAt.toLocaleDateString("ja-JP")]})]}),(0,a.jsx)(r.z,{variant:"ghost",onClick:o,children:"✕"})]})}),(0,a.jsxs)(i.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"元の摘要"}),(0,a.jsx)("p",{className:"p-2 bg-gray-50 rounded text-sm",children:t.originalDescription||t.memo})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"メモ"}),(0,a.jsx)("input",{type:"text",value:m.memo,onChange:e=>u({...m,memo:e.target.value}),className:"w-full p-2 border rounded mt-1",placeholder:"メモを入力"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"口座種別"}),(0,a.jsx)("select",{value:h,onChange:e=>g(e.target.value),className:"w-full p-2 border rounded mt-1",children:x.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"用途"}),(0,a.jsx)("select",{value:m.purpose,onChange:e=>u({...m,purpose:e.target.value}),className:"w-full p-2 border rounded mt-1",children:d.filter(e=>"oshi"===h?["ticket","goods","event","other"].includes(e.value):!["ticket","goods","event"].includes(e.value)).map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,a.jsx)("div",{className:"p-3 bg-blue-50 rounded-lg",children:(0,a.jsxs)("p",{className:"text-sm text-blue-700",children:[(0,a.jsx)("strong",{children:"編集後:"})," ","life"===h?"生活口座":"推し活口座"," • ",null===(s=d.find(e=>e.value===m.purpose))||void 0===s?void 0:s.label]})}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(r.z,{variant:"outline",onClick:o,className:"flex-1",children:"キャンセル"}),(0,a.jsx)(r.z,{onClick:b,className:"flex-1",children:"保存"})]})]})]})})}var u=t(3629),h=t(3570),g=t(9804);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let b=(0,g.Z)("HelpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),v=(0,g.Z)("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),f=(0,g.Z)("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);var j=t(5135),p=t(3438),N=t(4597),y=t(1354),w=t(3942);function k(){var e,s,t,i,d,x,g,k,S,A,C,D,I,T,E,z,Z,O,G,K,P,B,M,U,J,_,R,F,L,X,H;let[q,W]=(0,l.useState)(null),[Y,Q]=(0,l.useState)(!0),[V,$]=(0,l.useState)(null),[ee,es]=(0,l.useState)(null),[et,ea]=(0,l.useState)(null),[el,en]=(0,l.useState)(!1),[er,ec]=(0,l.useState)(!1),[ei,eo]=(0,l.useState)(""),[ed,ex]=(0,l.useState)(!1),[em,eu]=(0,l.useState)(!1),eh=(0,n.useRouter)();(0,l.useEffect)(()=>{(async()=>{try{Q(!0);let e=localStorage.getItem("currentUser");if(!e){eh.push("/login");return}let s=JSON.parse(e),t="https://oshieru-api.harukana1435.workers.dev",a=localStorage.getItem("sessionId");console.log("Dashboard API request details:",{userId:s.id,userEmail:s.email,sessionId:a,apiUrl:t});let l=s.email||localStorage.getItem("userEmail")||"customer1@oshieru.com",n=await fetch("".concat(t,"/dashboard"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a),"X-User-Email":l},body:JSON.stringify({userId:s.id})});if(!n.ok)throw Error("Failed to fetch dashboard data");let r=await n.json();if(r.success){let e=r.data.accounts||[],s=r.data.recentTransactions||[],t={user:r.data.user,accounts:e,totalBalance:e.reduce((e,s)=>e+(s.balanceCached||0),0),lifeAccount:e.find(e=>"life"===e.kind),oshiAccount:e.find(e=>"oshi"===e.kind),latestScore:r.data.latestScore,recentTransactions:s.map(e=>{var s,t;return{...e,eventAt:new Date(e.eventAt),createdAt:new Date(e.createdAt),accountKind:e.accountKind||((null===(s=e.accountId)||void 0===s?void 0:s.includes("life"))?"life":"oshi"),accountName:e.accountName||((null===(t=e.accountId)||void 0===t?void 0:t.includes("life"))?"生活口座":"推し活口座")}}),rewards:r.data.rewards||[],transactionCount:s.length},a=t.recentTransactions.filter(e=>"life"===e.accountKind),l=t.recentTransactions.filter(e=>"oshi"===e.accountKind),n=0;a.length>0&&(n=a.reduce((e,s)=>e+("in"===s.sign?s.amount:-s.amount),0));let c=0;l.length>0&&(c=l.reduce((e,s)=>e+("in"===s.sign?s.amount:-s.amount),0)),t.lifeBalance=n,t.oshiBalance=c,t.totalBalance=n+c,W(t)}else $(r.message||"データの取得に失敗しました")}catch(e){console.error("Dashboard fetch error:",e),$("ネットワークエラーが発生しました")}finally{Q(!1)}})()},[eh]),(0,l.useEffect)(()=>{q&&q.oshiAccount&&q.oshiAccount.balanceCached<0&&ec(!0)},[q]),(0,l.useEffect)(()=>{var e;er&&(null==q?void 0:null===(e=q.oshiAccount)||void 0===e?void 0:e.balanceCached)<0&&eo((Math.abs(q.oshiAccount.balanceCached)+1e4).toString())},[er,q]);let eg=async()=>{try{en(!0);let e=parseFloat(ei);if(!e||e<=0){alert("正しい金額を入力してください");return}if(!q.lifeAccount||q.lifeAccount.balanceCached<e){alert("生活口座の残高が不足しています");return}let s=localStorage.getItem("currentUser");if(!s)return;let t=JSON.parse(s),a="https://oshieru-api.harukana1435.workers.dev",l=localStorage.getItem("sessionId"),n=t.email||localStorage.getItem("userEmail")||"customer1@oshieru.com",r={accountId:q.lifeAccount.id,amount:e,sign:"out",purpose:"fund_transfer",memo:"資金移動 → 推し活口座 (￥".concat(e.toLocaleString(),")"),eventAt:new Date().toISOString()},c={accountId:q.oshiAccount.id,amount:e,sign:"in",purpose:"fund_transfer",memo:"資金移動 ← 生活口座 (￥".concat(e.toLocaleString(),")"),eventAt:new Date().toISOString()},i=await fetch("".concat(a,"/transactions"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(l),"X-User-Email":n},body:JSON.stringify(r)}),o=await fetch("".concat(a,"/transactions"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(l),"X-User-Email":n},body:JSON.stringify(c)});i.ok&&o.ok?window.location.reload():alert("振替処理に失敗しました")}catch(e){console.error("Balance transfer error:",e),alert("振替処理中にエラーが発生しました")}finally{en(!1),ec(!1),eo("")}},eb=async e=>{try{en(!0);let e=localStorage.getItem("currentUser");if(!e)return;let s=JSON.parse(e),t=localStorage.getItem("sessionId"),a=s.email||localStorage.getItem("userEmail")||"customer1@oshieru.com",l=await fetch("".concat("https://oshieru-api.harukana1435.workers.dev","/dashboard"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t),"X-User-Email":a},body:JSON.stringify({userId:s.id})});if(l.ok){let e=await l.json();if(e.success){let s=e.data.accounts||[],t=e.data.recentTransactions||[],a={user:e.data.user,accounts:s,totalBalance:s.reduce((e,s)=>e+(s.balanceCached||0),0),lifeAccount:s.find(e=>"life"===e.kind),oshiAccount:s.find(e=>"oshi"===e.kind),latestScore:e.data.latestScore,recentTransactions:t.map(e=>{var s,t;return{...e,eventAt:new Date(e.eventAt),createdAt:new Date(e.createdAt),accountKind:e.accountKind||((null===(s=e.accountId)||void 0===s?void 0:s.includes("life"))?"life":"oshi"),accountName:e.accountName||((null===(t=e.accountId)||void 0===t?void 0:t.includes("life"))?"生活口座":"推し活口座")}}),rewards:e.data.rewards||[],transactionCount:t.length};W(a)}}}catch(e){console.error("Transaction update error:",e)}finally{en(!1)}};return Y?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsx)(u.g,{})}):V?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-red-600 mb-4",children:V}),(0,a.jsx)(r.z,{onClick:()=>window.location.reload(),children:"再試行"})]})}):q?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"bg-white/80 backdrop-blur-xl rounded-3xl border border-gray-200/50 shadow-xl shadow-black/5",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-3 bg-gradient-to-r from-green-500 to-blue-500 rounded-full",children:(0,a.jsx)(h.Z,{className:"w-6 h-6 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"推し活安心度スコア"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"健康的な推し活の指標"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{onClick:()=>eh.push("/analysis"),className:"px-4 py-2 text-sm text-gray-600 bg-gray-50 hover:bg-gray-100 hover:text-gray-900 transition-all duration-200 rounded-xl border border-gray-200/50",children:"分析を見る"}),(0,a.jsx)("button",{onClick:()=>ex(!ed),className:"p-2 text-gray-400 hover:text-gray-600 rounded-full hover:bg-gray-100 transition-colors",children:(0,a.jsx)(b,{className:"w-5 h-5"})})]})]}),(0,a.jsxs)("div",{className:"flex flex-col lg:flex-row items-center gap-8",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)(e=>{let{score:s,size:t=120}=e,l=(t-20)/2,n=2*Math.PI*l*.75,r=n-n*s/100;return(0,a.jsxs)("div",{className:"relative inline-flex items-center justify-center",children:[(0,a.jsxs)("svg",{width:t,height:t,className:"transform -rotate-45",children:[(0,a.jsx)("circle",{cx:t/2,cy:t/2,r:l,fill:"none",stroke:"#e5e7eb",strokeWidth:"8",strokeDasharray:n,strokeDashoffset:"0",strokeLinecap:"round"}),(0,a.jsx)("circle",{cx:t/2,cy:t/2,r:l,fill:"none",stroke:s>=80?"#10b981":s>=60?"#f59e0b":s>=40?"#ef4444":"#6b7280",strokeWidth:"8",strokeDasharray:n,strokeDashoffset:r,strokeLinecap:"round",className:"transition-all duration-1000 ease-out"})]}),(0,a.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:s}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"点"})]})]})},{score:(null===(e=q.latestScore)||void 0===e?void 0:e.score)||0})}),(0,a.jsxs)("div",{className:"flex-1 space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"評価レベル"}),(0,a.jsx)("span",{className:"px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium",children:(null===(s=q.latestScore)||void 0===s?void 0:s.label)||"評価中"})]}),(null===(t=q.latestScore)||void 0===t?void 0:t.factors)&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("button",{onClick:()=>eu(!em),className:"flex items-center gap-2 text-sm text-blue-600 hover:text-blue-800 transition-colors",children:["詳細を表示",em?(0,a.jsx)(v,{className:"w-4 h-4"}):(0,a.jsx)(f,{className:"w-4 h-4"})]}),em&&(0,a.jsxs)("div",{className:"space-y-4 p-4 bg-gray-50/80 rounded-lg",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4 p-3 bg-white rounded-lg border",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"月収"}),(0,a.jsx)("p",{className:"text-lg font-bold text-gray-900",children:(null===(d=q.latestScore)||void 0===d?void 0:null===(i=d.analysisData)||void 0===i?void 0:i.income)?(0,c.xG)(q.latestScore.analysisData.income):"---"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"推し活費用"}),(0,a.jsx)("p",{className:"text-lg font-bold text-purple-600",children:(null===(g=q.latestScore)||void 0===g?void 0:null===(x=g.analysisData)||void 0===x?void 0:x.oshiExpense)?(0,c.xG)(q.latestScore.analysisData.oshiExpense):"---"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"生活必需品費用"}),(0,a.jsx)("p",{className:"text-lg font-bold text-green-600",children:(null===(S=q.latestScore)||void 0===S?void 0:null===(k=S.analysisData)||void 0===k?void 0:k.essentialExpense)?(0,c.xG)(q.latestScore.analysisData.essentialExpense):"---"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"余剰金"}),(0,a.jsx)("p",{className:"text-lg font-bold text-blue-600",children:(null===(C=q.latestScore)||void 0===C?void 0:null===(A=C.analysisData)||void 0===A?void 0:A.income)&&(null===(I=q.latestScore)||void 0===I?void 0:null===(D=I.analysisData)||void 0===D?void 0:D.essentialExpense)?(0,c.xG)(q.latestScore.analysisData.income-q.latestScore.analysisData.essentialExpense):"---"})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("h4",{className:"font-semibold text-gray-900 text-sm",children:"スコア内訳"}),(0,a.jsxs)("div",{className:"p-3 bg-white rounded-lg border",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"収入比率スコア"}),(0,a.jsxs)("span",{className:"text-sm font-bold text-gray-900",children:[(null===(E=q.latestScore)||void 0===E?void 0:null===(T=E.breakdown)||void 0===T?void 0:T.incomeRatioScore)||0,"点 / 40点"]})]}),(0,a.jsxs)("div",{className:"text-xs text-gray-600",children:["推し活費の割合: ",(null===(Z=q.latestScore)||void 0===Z?void 0:null===(z=Z.factors)||void 0===z?void 0:z.incomeRatio)?"".concat(Math.round(100*q.latestScore.factors.incomeRatio),"%"):"---",(0,a.jsx)("br",{}),(0,a.jsx)("span",{className:"text-gray-500",children:"(20%以下: 40点, 21-30%: 30点, 31-40%: 20点, 41%以上: 10点)"})]})]}),(0,a.jsxs)("div",{className:"p-3 bg-white rounded-lg border",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"余剰金スコア"}),(0,a.jsxs)("span",{className:"text-sm font-bold text-gray-900",children:[(null===(G=q.latestScore)||void 0===G?void 0:null===(O=G.breakdown)||void 0===O?void 0:O.surplusScore)||0,"点 / 30点"]})]}),(0,a.jsxs)("div",{className:"text-xs text-gray-600",children:["余剰金比率: ",(null===(P=q.latestScore)||void 0===P?void 0:null===(K=P.factors)||void 0===K?void 0:K.surplusRatio)?"".concat(Math.round(100*q.latestScore.factors.surplusRatio),"%"):"---",(0,a.jsx)("br",{}),(0,a.jsx)("span",{className:"text-gray-500",children:"(100%以下: 30点, 101-120%: 20点, 121-150%: 10点, 150%超: 0点)"})]})]}),(0,a.jsxs)("div",{className:"p-3 bg-white rounded-lg border",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"推奨額適合スコア"}),(0,a.jsxs)("span",{className:"text-sm font-bold text-gray-900",children:[(null===(M=q.latestScore)||void 0===M?void 0:null===(B=M.breakdown)||void 0===B?void 0:B.recommendedAmountScore)||0,"点 / 30点"]})]}),(0,a.jsxs)("div",{className:"text-xs text-gray-600",children:["推奨額: ",(null===(J=q.latestScore)||void 0===J?void 0:null===(U=J.analysisData)||void 0===U?void 0:U.recommendedAmount)?(0,c.xG)(q.latestScore.analysisData.recommendedAmount):"---",(0,a.jsx)("br",{}),"乖離率: ",(null===(R=q.latestScore)||void 0===R?void 0:null===(_=R.factors)||void 0===_?void 0:_.recommendedDeviation)?"".concat(Math.round(q.latestScore.factors.recommendedDeviation),"%"):"---",(0,a.jsx)("br",{}),(0,a.jsx)("span",{className:"text-gray-500",children:"(+10%以下: 30点, +10-20%: 20点, +20-50%: 10点, +50%超: 0点)"})]})]})]})]})]})]})]}),ed&&(0,a.jsxs)("div",{className:"mt-6 p-4 bg-blue-50/80 rounded-lg border border-blue-200",children:[(0,a.jsx)("h4",{className:"font-semibold text-blue-900 mb-2",children:"スコアについて"}),(0,a.jsxs)("div",{className:"text-sm text-blue-800 space-y-1",children:[(0,a.jsxs)("p",{children:["• ",(0,a.jsx)("strong",{children:"80点以上"}),": 非常に健全な推し活状況"]}),(0,a.jsxs)("p",{children:["• ",(0,a.jsx)("strong",{children:"60-79点"}),": 良好な推し活状況"]}),(0,a.jsxs)("p",{children:["• ",(0,a.jsx)("strong",{children:"40-59点"}),": 注意が必要な状況"]}),(0,a.jsxs)("p",{children:["• ",(0,a.jsx)("strong",{children:"40点未満"}),": 改善が必要な状況"]})]})]})]})}),(0,a.jsx)("div",{className:"bg-white/80 backdrop-blur-xl rounded-3xl border border-gray-200/50 shadow-xl shadow-black/5",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-3 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full",children:(0,a.jsx)(j.Z,{className:"w-6 h-6 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"総残高"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"全口座の合計金額"})]})]}),(0,a.jsx)("button",{onClick:()=>eh.push("/transactions"),className:"px-4 py-2 text-sm text-gray-600 bg-gray-50 hover:bg-gray-100 hover:text-gray-900 transition-all duration-200 rounded-xl border border-gray-200/50",children:"取引履歴を見る"})]}),(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)("div",{className:"text-4xl font-bold text-gray-900",children:(0,c.xG)(q.totalBalance||0)})})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,a.jsx)("div",{className:"bg-white/80 backdrop-blur-xl rounded-3xl border border-gray-200/50 shadow-xl shadow-black/5",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-3 bg-gradient-to-r from-green-500 to-green-600 rounded-full",children:(0,a.jsx)(p.Z,{className:"w-6 h-6 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-gray-900",children:"生活口座"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"日常生活に必要な資金"})]})]}),(0,a.jsx)("button",{onClick:()=>ea({...q.lifeAccount,transactions:q.recentTransactions.filter(e=>"life"===e.accountKind)}),className:"px-4 py-2 text-sm text-gray-600 bg-gray-50 hover:bg-gray-100 hover:text-gray-900 transition-all duration-200 rounded-xl border border-gray-200/50",children:"詳細を見る"})]}),(0,a.jsx)("div",{className:"text-center mb-4",children:(0,a.jsx)("div",{className:"text-3xl font-bold text-gray-900",children:(0,c.xG)((null===(F=q.lifeAccount)||void 0===F?void 0:F.balanceCached)||0)})}),(0,a.jsxs)("div",{className:"text-center text-sm text-gray-600",children:["取引件数: ",q.recentTransactions.filter(e=>"life"===e.accountKind&&!e.isPending).length,"件"]})]})}),(0,a.jsx)("div",{className:"bg-white/80 backdrop-blur-xl rounded-3xl border border-gray-200/50 shadow-xl shadow-black/5",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-3 bg-gradient-to-r from-purple-500 to-purple-600 rounded-full",children:(0,a.jsx)(N.Z,{className:"w-6 h-6 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-gray-900",children:"推し活口座"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"推し活動に使用する資金"})]})]}),(0,a.jsx)("button",{onClick:()=>ea({...q.oshiAccount,transactions:q.recentTransactions.filter(e=>"oshi"===e.accountKind)}),className:"px-4 py-2 text-sm text-gray-600 bg-gray-50 hover:bg-gray-100 hover:text-gray-900 transition-all duration-200 rounded-xl border border-gray-200/50",children:"詳細を見る"})]}),(0,a.jsx)("div",{className:"text-center mb-4",children:(0,a.jsx)("div",{className:"text-3xl font-bold text-gray-900",children:(0,c.xG)((null===(L=q.oshiAccount)||void 0===L?void 0:L.balanceCached)||0)})}),(0,a.jsxs)("div",{className:"text-center text-sm text-gray-600 mb-4",children:["取引件数: ",q.recentTransactions.filter(e=>"oshi"===e.accountKind&&!e.isPending).length,"件"]}),(null===(X=q.oshiAccount)||void 0===X?void 0:X.balanceCached)<0&&(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 mb-3",children:(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-red-600",children:[(0,a.jsx)(h.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"残高不足が発生しています"})]})}),(0,a.jsx)(r.z,{onClick:()=>ec(!0),className:"w-full bg-orange-500 hover:bg-orange-600 text-white mb-2",children:"資金移動"})]})]})})]}),q.rewards&&q.rewards.length>0&&(0,a.jsx)("div",{className:"bg-white/80 backdrop-blur-xl rounded-3xl border border-gray-200/50 shadow-xl shadow-black/5",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("h3",{className:"text-xl font-bold text-gray-900 mb-6 flex items-center gap-2",children:[(0,a.jsx)(y.Z,{className:"w-6 h-6 text-purple-600"}),"特典・サービス"]}),(0,a.jsx)("div",{className:"grid gap-4",children:q.rewards.map(e=>(0,a.jsx)("div",{className:"p-4 border border-gray-200 rounded-xl bg-white/60",children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h4",{className:"font-semibold text-gray-900 mb-2",children:e.title}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-3",children:e.description}),(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:["推し活安心度スコア",e.minScore,"点以上で利用可能"]})]}),(0,a.jsx)(r.z,{size:"sm",disabled:!q.latestScore||q.latestScore.score<e.minScore,className:"ml-4 flex items-center gap-1",children:(0,a.jsx)(w.Z,{className:"w-4 h-4"})})]})},e.id))})]})}),et&&(0,a.jsx)(o,{account:et,transactions:et.transactions||[],onClose:()=>ea(null)}),ee&&(0,a.jsx)(m,{transaction:ee,onClose:()=>es(null),onSave:eb}),er&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:(0,a.jsx)("div",{className:"bg-white rounded-3xl shadow-2xl max-w-md w-full mx-4",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"text-center mb-6",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)(h.Z,{className:"w-8 h-8 text-red-500"})}),(0,a.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"⚠️ 残高不足の警告"}),(0,a.jsxs)("p",{className:"text-gray-600",children:["推し活口座の残高がマイナスになっています。",(0,a.jsx)("br",{}),"生活口座から資金を移動しますか？"]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"現在の推し活口座残高"}),(0,a.jsx)("div",{className:"text-lg font-bold text-red-500",children:(null==q?void 0:q.oshiAccount)?(0,c.xG)(q.oshiAccount.balanceCached):"￥0"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"生活口座残高"}),(0,a.jsx)("div",{className:"text-lg font-bold text-green-600",children:(null==q?void 0:q.lifeAccount)?(0,c.xG)(q.lifeAccount.balanceCached):"￥0"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["移動する金額",(null==q?void 0:null===(H=q.oshiAccount)||void 0===H?void 0:H.balanceCached)<0&&(0,a.jsx)("span",{className:"text-xs text-gray-500 ml-2",children:"(推奨: 不足分 + \xa510,000)"})]}),(0,a.jsx)("input",{type:"number",value:ei,onChange:e=>eo(e.target.value),placeholder:"移動する金額を入力",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",min:"1",step:"1000"})]})]}),(0,a.jsxs)("div",{className:"flex gap-3 mt-6",children:[(0,a.jsx)(r.z,{onClick:()=>{ec(!1),eo("")},variant:"outline",className:"flex-1",children:"後で"}),(0,a.jsx)(r.z,{onClick:eg,className:"flex-1 bg-blue-500 hover:bg-blue-600 text-white",disabled:!ei||0>=parseFloat(ei),children:"振替実行"})]})]})})}),el&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/20 backdrop-blur-sm flex items-center justify-center z-50",children:(0,a.jsx)(u.g,{})})]}):(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsx)(u.g,{})})}},3942:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(9804).Z)("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]])},1354:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(9804).Z)("Gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]])},4597:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(9804).Z)("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]])}},function(e){e.O(0,[682,539,852,999,744],function(){return e(e.s=1890)}),_N_E=e.O()}]);