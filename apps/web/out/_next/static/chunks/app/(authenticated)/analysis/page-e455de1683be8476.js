(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[546],{5388:function(e,s,a){Promise.resolve().then(a.bind(a,7928))},7928:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return N}});var t=a(9075),l=a(511),n=a(5095),r=a(7839),c=a(1438),i=a(3629),d=a(9042),o=a(1947),x=a(3570),m=a(8132),h=a(5135),u=a(3438),j=a(9804);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let p=(0,j.Z)("Brain",[["path",{d:"M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z",key:"1mhkh5"}],["path",{d:"M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z",key:"1d6s00"}]]),f=(0,j.Z)("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);var g=a(6533);function y(){var e,s;let[a,j]=(0,l.useState)(!0),[y,N]=(0,l.useState)(null),[b,v]=(0,l.useState)(null),[w,k]=(0,l.useState)(!1),[S,Z]=(0,l.useState)(null),A=(0,n.useRouter)();(0,l.useEffect)(()=>{I()},[]);let I=async()=>{try{j(!0);let o=localStorage.getItem("currentUser");if(!o){A.push("/login");return}let x=JSON.parse(o),m=localStorage.getItem("sessionId"),h=x.email||localStorage.getItem("userEmail")||"customer1@oshieru.com",u=await fetch("".concat("https://oshieru-api.harukana1435.workers.dev","/dashboard"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(m),"X-User-Email":h},body:JSON.stringify({userId:x.id})});if(u.ok){let o=await u.json();if(o.success){var e,s,a,t,l,n,r,c,i,d;N({score:{total:(null===(e=o.data.latestScore)||void 0===e?void 0:e.score)||0,label:(null===(s=o.data.latestScore)||void 0===s?void 0:s.label)||"評価中",factors:(null===(a=o.data.latestScore)||void 0===a?void 0:a.factors)||{},breakdown:(null===(t=o.data.latestScore)||void 0===t?void 0:t.breakdown)||{incomeRatioScore:0,surplusScore:0,recommendedAmountScore:0}},accounts:{totalBalance:o.data.totalBalance||0,life:null===(l=o.data.accounts)||void 0===l?void 0:l.find(e=>"life"===e.kind),oshi:null===(n=o.data.accounts)||void 0===n?void 0:n.find(e=>"oshi"===e.kind)},summary:{totalTransactions:(null===(r=o.data.recentTransactions)||void 0===r?void 0:r.length)||0,oshiExpenses:(null===(c=o.data.recentTransactions)||void 0===c?void 0:c.filter(e=>"out"===e.sign&&"oshi"===e.accountKind).reduce((e,s)=>e+s.amount,0))||0,lifeExpenses:(null===(i=o.data.recentTransactions)||void 0===i?void 0:i.filter(e=>"out"===e.sign&&"life"===e.accountKind).reduce((e,s)=>e+s.amount,0))||0,income:(null===(d=o.data.recentTransactions)||void 0===d?void 0:d.filter(e=>"in"===e.sign&&"salary"===e.purpose).reduce((e,s)=>e+s.amount,0))||0}})}}}catch(e){console.error("Failed to fetch analysis data:",e),Z("データの取得に失敗しました")}finally{j(!1)}},E=async()=>{k(!0),Z(null);try{let e=JSON.parse(localStorage.getItem("currentUser")||"{}"),s=localStorage.getItem("sessionId"),a=e.email||localStorage.getItem("userEmail")||"customer1@oshieru.com",t=await fetch("".concat("https://oshieru-api.harukana1435.workers.dev","/analysis/rag-analysis"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s),"X-User-Email":a}});if(t.ok){let e=await t.json();console.log("RAG analysis response:",e),e.success?v(e.analysis):(console.error("RAG analysis failed:",e),Z(e.error||"Analysis failed"))}else{let e=await t.text();console.error("RAG analysis HTTP error:",t.status,e),Z("分析の実行に失敗しました (".concat(t.status,")"))}}catch(e){console.error("RAG analysis error:",e),Z("ネットワークエラーが発生しました")}finally{k(!1)}};return a?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-[60vh]",children:(0,t.jsx)(i.g,{})}):y?(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"スコア分析"}),(0,t.jsx)("p",{className:"text-gray-600",children:"推し活安心度スコアの詳細分析とAIによる個人分析"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,t.jsxs)(c.Zb,{className:"lg:col-span-1",children:[(0,t.jsx)(c.Ol,{children:(0,t.jsxs)(c.ll,{className:"flex items-center gap-2",children:[(0,t.jsx)(x.Z,{className:"w-5 h-5 text-green-600"}),"総合スコア"]})}),(0,t.jsx)(c.aY,{children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsxs)("div",{className:"text-4xl font-bold text-gray-900 mb-2",children:[y.score.total,(0,t.jsx)("span",{className:"text-lg text-gray-500",children:"/100"})]}),(0,t.jsx)("div",{className:"text-lg font-medium text-green-600 mb-4",children:y.score.label}),(0,t.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-3",children:(0,t.jsx)("div",{className:"bg-gradient-to-r from-green-500 to-blue-500 h-3 rounded-full transition-all duration-500",style:{width:"".concat(y.score.total,"%")}})})]})})]}),(0,t.jsxs)(c.Zb,{className:"lg:col-span-2",children:[(0,t.jsx)(c.Ol,{children:(0,t.jsxs)(c.ll,{className:"flex items-center gap-2",children:[(0,t.jsx)(m.Z,{className:"w-5 h-5 text-blue-600"}),"スコア内訳"]})}),(0,t.jsx)(c.aY,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,t.jsx)("span",{className:"font-medium text-gray-700",children:"収入比率スコア"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-24 bg-gray-200 rounded-full h-2",children:(0,t.jsx)("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:"".concat(y.score.breakdown.incomeRatioScore/40*100,"%")}})}),(0,t.jsxs)("span",{className:"text-sm font-bold text-gray-900 w-16 text-right",children:[y.score.breakdown.incomeRatioScore,"/40"]})]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,t.jsx)("span",{className:"font-medium text-gray-700",children:"余剰金スコア"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-24 bg-gray-200 rounded-full h-2",children:(0,t.jsx)("div",{className:"bg-green-500 h-2 rounded-full",style:{width:"".concat(y.score.breakdown.surplusScore/30*100,"%")}})}),(0,t.jsxs)("span",{className:"text-sm font-bold text-gray-900 w-16 text-right",children:[y.score.breakdown.surplusScore,"/30"]})]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,t.jsx)("span",{className:"font-medium text-gray-700",children:"推奨額適合スコア"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-24 bg-gray-200 rounded-full h-2",children:(0,t.jsx)("div",{className:"bg-purple-500 h-2 rounded-full",style:{width:"".concat(y.score.breakdown.recommendedAmountScore/30*100,"%")}})}),(0,t.jsxs)("span",{className:"text-sm font-bold text-gray-900 w-16 text-right",children:[y.score.breakdown.recommendedAmountScore,"/30"]})]})]})]})})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,t.jsxs)(c.Zb,{children:[(0,t.jsx)(c.Ol,{children:(0,t.jsxs)(c.ll,{className:"flex items-center gap-2",children:[(0,t.jsx)(h.Z,{className:"w-5 h-5 text-blue-600"}),"収支サマリー（直近3ヶ月）"]})}),(0,t.jsx)(c.aY,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"収入"}),(0,t.jsx)("span",{className:"font-bold text-green-600",children:(0,d.xG)(y.summary.income)})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"推し活支出"}),(0,t.jsx)("span",{className:"font-bold text-purple-600",children:(0,d.xG)(y.summary.oshiExpenses)})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"生活支出"}),(0,t.jsx)("span",{className:"font-bold text-blue-600",children:(0,d.xG)(y.summary.lifeExpenses)})]}),(0,t.jsx)("div",{className:"border-t pt-2",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"font-medium text-gray-900",children:"推し活比率"}),(0,t.jsx)("span",{className:"font-bold text-gray-900",children:y.summary.income>0?"".concat(Math.round(y.summary.oshiExpenses/y.summary.income*100),"%"):"---"})]})})]})})]}),(0,t.jsxs)(c.Zb,{children:[(0,t.jsx)(c.Ol,{children:(0,t.jsxs)(c.ll,{className:"flex items-center gap-2",children:[(0,t.jsx)(u.Z,{className:"w-5 h-5 text-green-600"}),"現在の残高"]})}),(0,t.jsx)(c.aY,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"総残高"}),(0,t.jsx)("span",{className:"font-bold text-gray-900",children:(0,d.xG)(y.accounts.totalBalance)})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"生活口座"}),(0,t.jsx)("span",{className:"font-bold text-green-600",children:(0,d.xG)((null===(e=y.accounts.life)||void 0===e?void 0:e.balanceCached)||0)})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"推し活口座"}),(0,t.jsx)("span",{className:"font-bold text-purple-600",children:(0,d.xG)((null===(s=y.accounts.oshi)||void 0===s?void 0:s.balanceCached)||0)})]}),(0,t.jsx)("div",{className:"border-t pt-2",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"font-medium text-gray-900",children:"取引回数"}),(0,t.jsxs)("span",{className:"font-bold text-gray-900",children:[y.summary.totalTransactions,"件"]})]})})]})})]})]}),(0,t.jsxs)(c.Zb,{children:[(0,t.jsx)(c.Ol,{children:(0,t.jsxs)(c.ll,{className:"flex items-center gap-2",children:[(0,t.jsx)(p,{className:"w-5 h-5 text-purple-600"}),"AI推し活分析"]})}),(0,t.jsxs)(c.aY,{children:[!b&&!w&&(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)("div",{className:"w-16 h-16 bg-gradient-to-r from-purple-100 to-pink-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,t.jsx)(f,{className:"w-8 h-8 text-purple-600"})}),(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"個人分析を開始"}),(0,t.jsxs)("p",{className:"text-gray-600 mb-6",children:["あなたの推し活パターンをAIが詳しく分析し、",(0,t.jsx)("br",{}),"個別のアドバイスを提供します。"]}),(0,t.jsxs)(r.z,{onClick:E,className:"bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white",children:[(0,t.jsx)(p,{className:"w-4 h-4 mr-2"}),"AI分析を開始"]})]}),w&&(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)(g.Z,{className:"w-8 h-8 animate-spin text-purple-600 mx-auto mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"分析中..."}),(0,t.jsx)("p",{className:"text-gray-600",children:"AIがあなたの推し活データを詳しく分析しています"})]}),S&&(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)(o.Z,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"エラーが発生しました"}),(0,t.jsx)("p",{className:"text-red-600 mb-4",children:S}),(0,t.jsx)(r.z,{onClick:E,variant:"outline",children:"再試行"})]}),b&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("div",{className:"prose prose-sm max-w-none",children:(0,t.jsx)("div",{className:"whitespace-pre-wrap text-gray-700 leading-relaxed bg-gray-50 rounded-lg p-4",children:b})}),(0,t.jsx)("div",{className:"flex justify-center pt-4",children:(0,t.jsx)(r.z,{onClick:E,variant:"outline",size:"sm",children:"再分析"})})]})]})]})]}):(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)(o.Z,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),(0,t.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"データの読み込みに失敗しました"}),(0,t.jsx)("p",{className:"text-gray-600 mb-4",children:"しばらく時間をおいて再度お試しください"}),(0,t.jsx)(r.z,{onClick:I,children:"再読み込み"})]})}function N(){return(0,t.jsx)(y,{})}},1947:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let t=(0,a(9804).Z)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},8132:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let t=(0,a(9804).Z)("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]])},6533:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let t=(0,a(9804).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])}},function(e){e.O(0,[682,539,852,999,744],function(){return e(e.s=5388)}),_N_E=e.O()}]);