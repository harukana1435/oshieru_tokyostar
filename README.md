# æ¨ã—ã‚¨ãƒ¼ãƒ«å£åº§ ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—

å¥åº·çš„ã«æ¨ã—æ´»ã‚’ç¶šã‘ã‚‹ãŸã‚ã®å£åº§ç®¡ç†ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚AI ã«ã‚ˆã‚‹æ¨ã—æ´»å®‰å¿ƒåº¦ã‚¹ã‚³ã‚¢ç®—å‡ºæ©Ÿèƒ½ã‚’æ­è¼‰ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç„¡ç†ã®ãªã„ç¯„å›²ã§æ¨ã—æ´»ã‚’æ¥½ã—ã‚ã‚‹ã‚ˆã†æ”¯æ´ã—ã¾ã™ã€‚

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: Next.js 14 (App Router) + TypeScript + Tailwind CSS + shadcn/ui
- **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**: Cloudflare Workers (Hono + TypeScript)  
- **ã‚¹ã‚³ã‚¢è¨ˆç®—**: Cloudflare Workers (Python)
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: Cloudflare D1 (SQLite) + drizzle-orm
- **ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°**: Cloudflare Pages (ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰) + Cloudflare Workers (API)
- **ãƒ¢ãƒãƒ¬ãƒ**: pnpm + Turborepo

## ğŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

```
repo/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ web/                 # Next.js ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
â”‚   â”œâ”€â”€ api/                 # Hono API Worker
â”‚   â””â”€â”€ score/               # Python ã‚¹ã‚³ã‚¢è¨ˆç®— Worker
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ types/               # å…±é€šå‹å®šç¾© (Zod ã‚¹ã‚­ãƒ¼ãƒ)
â”‚   â”œâ”€â”€ db/                  # drizzle-orm ã‚¹ã‚­ãƒ¼ãƒ & ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â””â”€â”€ config/              # å…±é€šè¨­å®š
â”œâ”€â”€ infra/cf/               # Cloudflare è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
â””â”€â”€ docs/                   # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
```

## âœ¨ ä¸»è¦æ©Ÿèƒ½

### ğŸ“Š æ¨ã—æ´»å®‰å¿ƒåº¦ã‚¹ã‚³ã‚¢
- **åå…¥æ¯”ç‡ã‚¹ã‚³ã‚¢** (40ç‚¹): æ¨ã—æ´»è²»ç”¨ãŒåå…¥ã«å¯¾ã—ã¦é©åˆ‡ãªå‰²åˆã‹ã‚’åˆ¤å®š
- **ä½™å‰°é‡‘ã‚¹ã‚³ã‚¢** (30ç‚¹): ç”Ÿæ´»å¿…éœ€æ”¯å‡ºã‚’å·®ã—å¼•ã„ãŸä½™å‰°é‡‘ã®ç¯„å›²å†…ã‹ã‚’åˆ¤å®š  
- **æ¨å¥¨é¡é©åˆã‚¹ã‚³ã‚¢** (30ç‚¹): ã‚·ã‚¹ãƒ†ãƒ æ¨å¥¨é¡ã¨ã®ä¹–é›¢åº¦ã‚’è©•ä¾¡

### ğŸ¤– ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆå–å¼•ç®¡ç†
- **è‡ªå‹•æŒ¯ã‚Šåˆ†ã‘**: çµ¦ä¸ãƒ»é›»æ°—æ–™é‡‘ç­‰ã¯è‡ªå‹•ã§ã‚«ãƒ†ã‚´ãƒªåˆ†é¡
- **ä¿ç•™ã‚°ãƒ«ãƒ¼ãƒ—**: ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ãƒ»æŒ¯è¾¼ç­‰ã¯æ‰‹å‹•æŒ¯ã‚Šåˆ†ã‘å¾…ã¡
- **ç·¨é›†æ©Ÿèƒ½**: å…¨ã¦ã®å–å¼•ã®ç”¨é€”ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå¾Œã‹ã‚‰ç·¨é›†å¯èƒ½
- **å®Ÿãƒ‡ãƒ¼ã‚¿å¯¾å¿œ**: 3äººã®å®Ÿéš›ã®é¡§å®¢ãƒ‡ãƒ¼ã‚¿ï¼ˆ178ä»¶ã®å–å¼•å±¥æ­´ï¼‰

### ğŸ’° å£åº§ç®¡ç†
- **ç”Ÿæ´»å£åº§**: æ—¥å¸¸ã®åå…¥ãƒ»æ”¯å‡ºç®¡ç†
- **æ¨ã—æ´»å£åº§**: æ¨ã—æ´»å°‚ç”¨ã®äºˆç®—ç®¡ç†
- **å–å¼•å±¥æ­´**: ç›®çš„åˆ¥ã®æ”¯å‡ºè¨˜éŒ²ãƒ»åˆ†æ

### ğŸ ç‰¹å…¸ã‚·ã‚¹ãƒ†ãƒ 
- ã‚¹ã‚³ã‚¢ã«å¿œã˜ãŸä¼šå“¡ãƒ©ãƒ³ã‚¯
- é™å®šã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚·ãƒ§ãƒƒãƒ—ã‚¢ã‚¯ã‚»ã‚¹
- ä½é‡‘åˆ©ãƒ­ãƒ¼ãƒ³ãƒ»åˆ†å‰²æ‰•ã„å„ªé‡
- è·ç‰©é ã‹ã‚Šã‚µãƒ¼ãƒ“ã‚¹

### ğŸ“± ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ
- ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³å„ªå…ˆã®ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³
- ã‚¿ãƒƒãƒæ“ä½œã«æœ€é©åŒ–ã•ã‚ŒãŸUI/UX

## ğŸš€ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

### 1. ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# pnpm ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« (æœªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®å ´åˆ)
npm install -g pnpm

# ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pnpm install
```

### 2. Cloudflare è¨­å®š

#### D1 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä½œæˆ
```bash
# D1 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆ
wrangler d1 create oshieru-db

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ ID ã‚’ wrangler.toml ã«è¨­å®š
# infra/cf/wrangler.toml ã® database_id ã‚’æ›´æ–°
```

#### KV ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ä½œæˆ
```bash
# KV ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ã‚’ä½œæˆ
wrangler kv:namespace create "SESSIONS"
wrangler kv:namespace create "SESSIONS" --preview

# ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ ID ã‚’ wrangler.toml ã«è¨­å®š
```

### 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

```bash
# ã‚¹ã‚­ãƒ¼ãƒç”Ÿæˆ
pnpm db:generate

# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
pnpm db:migrate

# ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿æŠ•å…¥ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
cd packages/db && node -e "
import('./seed.ts').then(async ({ seedDatabase }) => {
  const { drizzle } = await import('drizzle-orm/d1');
  // D1 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šè¨­å®šãŒå¿…è¦
  console.log('Seed script ready - manual execution required');
});
"
```

### 4. é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•

```bash
# ã™ã¹ã¦ã®ã‚¢ãƒ—ãƒªã‚’åŒæ™‚èµ·å‹•
pnpm dev

# å€‹åˆ¥èµ·å‹•ã®å ´åˆ
pnpm --filter @oshieru/web dev      # Next.js (localhost:3000)
pnpm --filter @oshieru/api dev      # API Worker (localhost:8787)
```

## ğŸ”§ é–‹ç™ºã‚³ãƒãƒ³ãƒ‰

```bash
# ãƒ“ãƒ«ãƒ‰
pnpm build

# å‹ãƒã‚§ãƒƒã‚¯
pnpm type-check

# ãƒªãƒ³ã‚¿ãƒ¼
pnpm lint

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œ
pnpm db:generate    # ã‚¹ã‚­ãƒ¼ãƒç”Ÿæˆ
pnpm db:migrate     # ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
pnpm db:studio      # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†ç”»é¢
```

## ğŸš¢ ãƒ‡ãƒ—ãƒ­ã‚¤

### Cloudflare Workers (API)
```bash
cd apps/api
wrangler deploy --env api
```

### Cloudflare Workers (ã‚¹ã‚³ã‚¢è¨ˆç®—)
```bash
cd apps/score
wrangler deploy --env score
```

### Cloudflare Pages (ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰)
1. GitHub ãƒªãƒã‚¸ãƒˆãƒªã‚’ Cloudflare Pages ã«é€£æº
2. ãƒ“ãƒ«ãƒ‰è¨­å®š:
   - **Framework preset**: Next.js
   - **Build command**: `cd apps/web && npm run build`
   - **Build output directory**: `apps/web/.next`

## ğŸ“Š æ¨ã—æ´»å®‰å¿ƒåº¦ã‚¹ã‚³ã‚¢ä»•æ§˜

è©³ç´°ãªè¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ã¯ [`oshikatu_safety_score.md`](./oshikatu_safety_score.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### ã‚¹ã‚³ã‚¢æ§‹æˆ
- **ç·åˆã‚¹ã‚³ã‚¢**: 0-100ç‚¹
- **è©•ä¾¡ãƒ©ãƒ™ãƒ«**: 
  - 80ç‚¹ä»¥ä¸Š: "ã¨ã¦ã‚‚å®‰å¿ƒ"
  - 60-79ç‚¹: "å®‰å¿ƒ"  
  - 40-59ç‚¹: "æ³¨æ„"
  - 39ç‚¹ä»¥ä¸‹: "å±é™º"

## ğŸ¯ API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

### èªè¨¼
- `POST /auth/login` - ãƒ­ã‚°ã‚¤ãƒ³
- `GET /auth/me` - ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—
- `POST /auth/logout` - ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ

### å£åº§ç®¡ç†  
- `GET /accounts` - å£åº§ä¸€è¦§
- `POST /accounts` - å£åº§ä½œæˆ
- `GET /accounts/:id` - å£åº§è©³ç´°

### å–å¼•ç®¡ç†
- `GET /transactions` - å–å¼•å±¥æ­´
- `POST /transactions` - å–å¼•ä½œæˆ
- `GET /transactions/account/:accountId` - å£åº§åˆ¥å–å¼•å±¥æ­´

### ã‚¹ã‚³ã‚¢ç®¡ç†
- `GET /scores` - ã‚¹ã‚³ã‚¢å±¥æ­´
- `GET /scores/latest` - æœ€æ–°ã‚¹ã‚³ã‚¢
- `POST /scores/calculate` - ã‚¹ã‚³ã‚¢è¨ˆç®—

### ç‰¹å…¸ç®¡ç†
- `GET /rewards` - ç‰¹å…¸ä¸€è¦§
- `GET /rewards/my` - è‡ªåˆ†ã®ç‰¹å…¸çŠ¶æ³
- `POST /rewards/:id/redeem` - ç‰¹å…¸äº¤æ›

### ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ»åˆ†æ
- `GET /dashboard` - ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿
- `GET /analysis/oshi-spending` - æ¨ã—æ´»æ”¯å‡ºåˆ†æ

## ğŸ§ª ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿

å®Ÿéš›ã®ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ãŸ3äººã®é¡§å®¢:

### é¡§å®¢1 (`customer1@oshieru.com`)
- **ç”Ÿæ´»å£åº§æ®‹é«˜**: Â¥380,000
- **å–å¼•ä»¶æ•°**: 51ä»¶
- **æœ€æ–°ã‚¹ã‚³ã‚¢**: 60ç‚¹ (å®‰å¿ƒ)
- **ç‰¹å¾´**: çµ¦ä¸æŒ¯è¾¼ã€ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰æ”¯æ‰•ã„ç­‰ã®ä¸€èˆ¬çš„ãªå–å¼•ãƒ‘ã‚¿ãƒ¼ãƒ³

### é¡§å®¢2 (`customer2@oshieru.com`)
- **ç”Ÿæ´»å£åº§æ®‹é«˜**: Â¥1,399,999
- **å–å¼•ä»¶æ•°**: 56ä»¶
- **æœ€æ–°ã‚¹ã‚³ã‚¢**: 70ç‚¹ (å®‰å¿ƒ)
- **ç‰¹å¾´**: é«˜é¡åå…¥ã€æŠ•è³‡é–¢é€£å–å¼•ã‚’å«ã‚€

### é¡§å®¢3 (`customer3@oshieru.com`)
- **ç”Ÿæ´»å£åº§æ®‹é«˜**: Â¥230
- **å–å¼•ä»¶æ•°**: 71ä»¶
- **æœ€æ–°ã‚¹ã‚³ã‚¢**: 80ç‚¹ (ã¨ã¦ã‚‚å®‰å¿ƒ)
- **ç‰¹å¾´**: å°‘é¡å–å¼•ãŒå¤šãã€ç´°ã‹ã„æ”¯å‡ºç®¡ç†ãŒç‰¹å¾´

## ğŸ¤ ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³

1. ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒ•ã‚©ãƒ¼ã‚¯
2. ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆ (`git checkout -b feature/amazing-feature`)
3. å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆ (`git commit -m 'Add amazing feature'`)
4. ãƒ–ãƒ©ãƒ³ãƒã«ãƒ—ãƒƒã‚·ãƒ¥ (`git push origin feature/amazing-feature`)
5. Pull Request ã‚’ä½œæˆ

## ğŸ“„ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ MIT ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®ä¸‹ã§å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚

## ğŸ”— é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [ã‚µãƒ¼ãƒ“ã‚¹æ¦‚è¦](./service_overview.md)
- [é–‹ç™ºä»•æ§˜æ›¸](./devlopment_outline.md)  
- [æ¨ã—æ´»å®‰å¿ƒåº¦ã‚¹ã‚³ã‚¢ä»•æ§˜](./oshikatu_safety_score.md) # oshieru_tokyostar
